/* Built from X 4.21 by XAG 1.0. 26Feb10 13:19 UT */
xLibrary={version:"4.21",license:"GNU LGPL",url:"http://cross-browser.com/"};function xAddClass(b,d){if((b=xGetElementById(b))!=null){var a="";if(b.className.length&&b.className.charAt(b.className.length-1)!=" "){a=" "}if(!xHasClass(b,d)){b.className+=a+d;return true}}return false}function xAddEventListener(d,c,b,a){if(!(d=xGetElementById(d))){return}c=c.toLowerCase();if(d.addEventListener){d.addEventListener(c,b,a||false)}else{if(d.attachEvent){d.attachEvent("on"+c,b)}else{var f=d["on"+c];d["on"+c]=typeof f=="function"?function(e){f(e);b(e)}:b}}}function xAniLine(e,x,y,t,a,oe){if(!(e=xGetElementById(e))){return}var x0=xLeft(e),y0=xTop(e);x=Math.round(x);y=Math.round(y);var dx=x-x0,dy=y-y0;var fq=1/t;if(a){fq*=(Math.PI/2)}var t0=new Date().getTime();var tmr=setInterval(function(){var et=new Date().getTime()-t0;if(et<t){var f=et*fq;if(a==1){f=Math.sin(f)}else{if(a==2){f=1-Math.cos(f)}}f=Math.abs(f);e.style.left=Math.round(f*dx+x0)+"px";e.style.top=Math.round(f*dy+y0)+"px"}else{clearInterval(tmr);e.style.left=x+"px";e.style.top=y+"px";if(typeof oe=="function"){oe()}else{if(typeof oe=="string"){eval(oe)}}}},10)}function xCamelize(d){var e,g,b,f;b=d.split("-");f=b[0];for(e=1;e<b.length;++e){g=b[e].charAt(0);f+=b[e].replace(g,g.toUpperCase())}return f}function xClientHeight(){var b=0,c=document,a=window;if((!c.compatMode||c.compatMode=="CSS1Compat")&&c.documentElement&&c.documentElement.clientHeight){b=c.documentElement.clientHeight}else{if(c.body&&c.body.clientHeight){b=c.body.clientHeight}else{if(xDef(a.innerWidth,a.innerHeight,c.width)){b=a.innerHeight;if(c.width>a.innerWidth){b-=16}}}}return b}function xClientWidth(){var b=0,c=document,a=window;if((!c.compatMode||c.compatMode=="CSS1Compat")&&!a.opera&&c.documentElement&&c.documentElement.clientWidth){b=c.documentElement.clientWidth}else{if(c.body&&c.body.clientWidth){b=c.body.clientWidth}else{if(xDef(a.innerWidth,a.innerHeight,c.height)){b=a.innerWidth;if(c.height>a.innerHeight){b-=16}}}}return b}function xDef(){for(var a=0;a<arguments.length;++a){if(typeof(arguments[a])=="undefined"){return false}}return true}function xGetComputedStyle(g,f,c){if(!(g=xGetElementById(g))){return null}var d,a="undefined",b=document.defaultView;if(b&&b.getComputedStyle){d=b.getComputedStyle(g,"");if(d){a=d.getPropertyValue(f)}}else{if(g.currentStyle){a=g.currentStyle[xCamelize(f)]}else{return null}}return c?(parseInt(a)||0):a}function xGetElementById(a){if(typeof(a)=="string"){if(document.getElementById){a=document.getElementById(a)}else{if(document.all){a=document.all[a]}else{a=null}}}return a}function xHasClass(b,d){b=xGetElementById(b);if(!b||b.className==""){return false}var a=new RegExp("(^|\\s)"+d+"(\\s|$)");return a.test(b.className)}function xHeight(i,f){var d,g=0,c=0,b=0,j=0,a;if(!(i=xGetElementById(i))){return 0}if(xNum(f)){if(f<0){f=0}else{f=Math.round(f)}}else{f=-1}d=xDef(i.style);if(i==document||i.tagName.toLowerCase()=="html"||i.tagName.toLowerCase()=="body"){f=xClientHeight()}else{if(d&&xDef(i.offsetHeight)&&xStr(i.style.height)){if(f>=0){if(document.compatMode=="CSS1Compat"){a=xGetComputedStyle;g=a(i,"padding-top",1);if(g!==null){c=a(i,"padding-bottom",1);b=a(i,"border-top-width",1);j=a(i,"border-bottom-width",1)}else{if(xDef(i.offsetHeight,i.style.height)){i.style.height=f+"px";g=i.offsetHeight-f}}}f-=(g+c+b+j);if(isNaN(f)||f<0){return}else{i.style.height=f+"px"}}f=i.offsetHeight}else{if(d&&xDef(i.style.pixelHeight)){if(f>=0){i.style.pixelHeight=f}f=i.style.pixelHeight}}}return f}function xLeft(c,a){if(!(c=xGetElementById(c))){return 0}var b=xDef(c.style);if(b&&xStr(c.style.left)){if(xNum(a)){c.style.left=a+"px"}else{a=parseInt(c.style.left);if(isNaN(a)){a=xGetComputedStyle(c,"left",1)}if(isNaN(a)){a=0}}}else{if(b&&xDef(c.style.pixelLeft)){if(xNum(a)){c.style.pixelLeft=a}else{a=c.style.pixelLeft}}}return a}function xMoveTo(b,a,c){xLeft(b,a);xTop(b,c)}function xNum(){for(var a=0;a<arguments.length;++a){if(isNaN(arguments[a])||typeof(arguments[a])!="number"){return false}}return true}function xPreventDefault(a){if(a&&a.preventDefault){a.preventDefault()}else{if(window.event){window.event.returnValue=false}}}function xStopPropagation(a){if(a&&a.stopPropagation){a.stopPropagation()}else{if(window.event){window.event.cancelBubble=true}}}function xStr(b){for(var a=0;a<arguments.length;++a){if(typeof(arguments[a])!="string"){return false}}return true}function xTop(b,c){if(!(b=xGetElementById(b))){return 0}var a=xDef(b.style);if(a&&xStr(b.style.top)){if(xNum(c)){b.style.top=c+"px"}else{c=parseInt(b.style.top);if(isNaN(c)){c=xGetComputedStyle(b,"top",1)}if(isNaN(c)){c=0}}}else{if(a&&xDef(b.style.pixelTop)){if(xNum(c)){b.style.pixelTop=c}else{c=b.style.pixelTop}}}return c}function xWidth(g,b){var d,f=0,i=0,h=0,c=0,a;if(!(g=xGetElementById(g))){return 0}if(xNum(b)){if(b<0){b=0}else{b=Math.round(b)}}else{b=-1}d=xDef(g.style);if(g==document||g.tagName.toLowerCase()=="html"||g.tagName.toLowerCase()=="body"){b=xClientWidth()}else{if(d&&xDef(g.offsetWidth)&&xStr(g.style.width)){if(b>=0){if(document.compatMode=="CSS1Compat"){a=xGetComputedStyle;f=a(g,"padding-left",1);if(f!==null){i=a(g,"padding-right",1);h=a(g,"border-left-width",1);c=a(g,"border-right-width",1)}else{if(xDef(g.offsetWidth,g.style.width)){g.style.width=b+"px";f=g.offsetWidth-b}}}b-=(f+i+h+c);if(isNaN(b)||b<0){return}else{g.style.width=b+"px"}}b=g.offsetWidth}else{if(d&&xDef(g.style.pixelWidth)){if(b>=0){g.style.pixelWidth=b}b=g.style.pixelWidth}}}return b}KP_ATOMIX=(function(){var N=39,I=41,A=20,z=0,k={"1":"hydrogen","2":"carbon","3":"oxygen","4":"nitrogen","5":"sulphur","6":"fluorine","7":"chlorine","8":"bromine","9":"phosphorus",o:"crystal",A:"connector-horizontal",B:"connector-slash",C:"connector-vertical",D:"connector-backslash"},i={a:"top-single",b:"top-right",c:"right-single",d:"bottom-right",e:"bottom-single",f:"bottom-left",g:"left-single",h:"top-left",A:"top-double",B:"right-double",C:"bottom-double",D:"left-double",E:"top-triple",F:"right-triple",G:"bottom-triple",H:"left-triple"},q,D,v,G,d,e,c,h,p,J=xGetElementById;function l(V,U){for(var T=0;T<V.length;T+=1){U(V[T],T,V)}}function H(U){var V=0,T=arguments;return U.replace(/\f/g,function(){V+=1;return(V<T.length)?T[V]:""})}function P(T){return A+T*I}function o(T){return z+T*N}function s(T){return T.join("\n").split("\n")}function b(T){return function(U){f(T);j()}}function F(T){xAddEventListener(J("next-level"),"click",E,false);xAddEventListener(J("prev-level"),"click",u,false);xAddEventListener(J("history-reset"),"click",b("reset"),false);xAddEventListener(J("history-undo"),"click",b("undo"),false);xAddEventListener(J("history-redo"),"click",b("redo"),false)}function x(){y();gMoveFlag=false}function M(U,V,T){if(p.grid[V].charAt(T)==="."){xTop(U,o(V));xLeft(U,P(T))}else{xLeft(U,-1000)}}function y(){var U=v.row,T=v.col;M(D[0],U,T-1);M(D[1],U,T+1);M(D[2],U-1,T);M(D[3],U+1,T)}function K(){l(D,function(T){xLeft(T,-1000)})}function t(){l("left right up down".split(" "),function(U){var T=O(G,"atom arrow-"+U,0,-1000);D.push(T);xAddEventListener(T,"click",function(V){S(U)},false)})}function w(W,T){var U,V;for(U=0;U<q.length;U+=1){V=q[U];if(V.row===W&&V.col===T){return V}}return null}function C(T){v=T;y(T)}function O(V,T,X,W){var U=document.createElement("div");if(V){V.appendChild(U)}xAddClass(U,T);xTop(U,X);xLeft(U,W);return U}function j(T){xStopPropagation(T);xPreventDefault(T)}function m(T){T=T.split("-");T[0]=parseInt(T[0],10);T[1]=parseInt(T[1],10);T[2]=parseInt(T[2],10);T[3]=parseInt(T[3],10);return T}function f(U){var T;switch(U){case"reset":a(e,true);return;case"undo":if(!p.history.length||gMoveFlag){return}T=p.history.pop();p.redo.push(T);T=m(T);v=w(T[2],T[3]);L(T[0],T[1]);return;case"redo":if(!p.redo.length|gMoveFlag){return}T=p.redo.pop();p.history.push(T);T=m(T);v=w(T[0],T[1]);L(T[2],T[3]);return;default:return}return}function u(T){if(e>0){a(e-1)}j()}function E(U){var T=h.length-1;if(e<T){a(e+1)}j()}function B(T){C(T)}function S(U){var Y=v.row,T=v.col,W=Y,Z=T,V=p.grid,X=V[Y];switch(U){case"left":while(X.charAt(T-1)==="."){T-=1}break;case"right":while(X.charAt(T+1)==="."){T+=1}break;case"up":while(V[Y-1].charAt(T)==="."){Y-=1}break;case"down":while(V[Y+1].charAt(T)==="."){Y+=1}break;default:break}if(Y!==v.row||T!==v.col){p.history.push(H("\f-\f-\f-\f",W,Z,Y,T));p.redo=[];L(Y,T)}}function L(X,T){var U=p.grid,Y=v.col,V=v.row,W;K();n();W=U[V].charAt(Y);U[V]=U[V].slice(0,Y)+"."+U[V].slice(Y+1);U[X]=U[X].slice(0,T)+W+U[X].slice(T+1);v.row=X;v.col=T;W=100*Math.abs(V-X+Y-T);gMoveFlag=true;xAniLine(v.atom,P(T),o(X),W,1,x)}function r(Y,X,ab,T){var Z=c.atoms[X],V,U,W,aa;V=O(Y,"atom",o(ab),P(T));U={row:ab,col:T,atom:V};if(Y===G){q.push(U);xAddEventListener(V,"click",function(ac){B(U)},false)}O(V,k[Z[0]]+" atom");W=Z[1];for(aa=0;aa<W.length;aa+=1){O(V,"bond "+i[W.charAt(aa)],0,0)}return V}function R(){var U,V,W,T;for(W=0;W<p.grid.length;W+=1){U=p.grid[W];for(T=0;T<U.length;T+=1){switch(U.charAt(T)){case"#":O(G,"arena-wall",o(W),P(T));break;case".":break;default:r(G,U.charAt(T),W,T)}}}xHeight(G,o(W));xWidth(G,P(T)+A);xWidth(J("controls"),P(T)+A);V=c.molecule;for(W=0;W<V.length;W+=1){U=V[W];for(T=0;T<U.length;T+=1){if(U.charAt(T)!=="."){r(d,U.charAt(T),W,T)}}}xMoveTo(d,xLeft(G)+xWidth(G)+40,xTop(G)+40);C(q[0]);t();y()}function n(){J("leveldata").innerHTML=H("<h4>Level \f: \f (\f moves)</h4>",e+1,c.name,p.history.length)}function g(T){c.gameData=p={};p.grid=s(c.arena);p.history=[];p.redo=[]}function a(T,U){T=T||0;q=[];D=[];G=J("arena");G.innerHTML="&nbsp;";d=J("molecule");d.innerHTML="&nbsp;";c=h[T];e=T;if(!xDef(c.gameData)||U===true){g()}else{p=c.gameData}v=null;R();n()}function Q(T){h=KP_ATOMIX.levels.katomic;F();a(T)}return{init:Q,levels:{}}}());